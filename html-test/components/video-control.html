<template>
    <p></p>
</template>

<script>
    // TODO: This seems to only work in Chrome, verifying.
    
    // Video-control: This component fetches relevant video links onPageLoad, generates a clickable object,
    // and publishes the video links onClick.
    // @param prefix The NDN prefix for published video controls.
    //   If left undefined, the component will try to see if a matching meta definition exists in the html.
    //   If no meta definition can be found either, component will ignore this component, 
    //   (and component should somehow tell the parser to print a warning)
    // @param showid The show ID is the first component that comes after the prefix.
    //   If left undefined, the component will try to see if a matching meta definition exists in the html.
    //   If no meta definition can be found either, component will ignore this component, 
    //   (and component should somehow tell the parser to print a warning)
    // @param subname A list of name components following the showid name component.
    //   (Or alternatively, we can infer this from component name, for this component, there could be a mandatory "video-control" component automatically appended)
    //   This parameter can be an array in JSON.
    // @param videotags A list of video tags to use when querying the database.
    //   (Query process should base on semantic-aware server-side logic?)
    //   This parameter can be an array in JSON.
    // @param keyid The key associated with the fetched result. 
    //   If there are multiple occurrences of the same component, with the same parameters,
    //   having the same key among them would link the same video url, while having different
    //   keys will tell the component to prefer different randomized results.
    // @param description The text description of the clickable object generated by this web component.
    (function(window, document, undefined) {
        var thatDoc = document;
        var thisDoc =  (thatDoc._currentScript || thatDoc.currentScript).ownerDocument;
        var template = thisDoc.querySelector('template').content;
        
        var VideoControlElement = Object.create(HTMLElement.prototype);
        
        VideoControlElement.createdCallback = function() {
            var shadowRoot = this.createShadowRoot();
            var clone = thatDoc.importNode(template, true);
            shadowRoot.appendChild(clone);
            
            // We may not want to contain these in a paragraph at some point
            this.innerElement = shadowRoot.querySelector('p');
            
            if (this.hasAttribute('description')) {
                this.innerElement.textContent = this.getAttribute('description');
            }
            
            var nameComponents = [];
            if (this.hasAttribute('subname')) {
                nameComponents = JSONStringToArray(this.getAttribute('subname'));
                console.log(nameComponents);
            }
            
            if (this.hasAttribute('prefix')) {
                
            }
            // Queries the Cassandra database for related video links
            
            this.innerElement.addEventListener('click', function(){
                console.log('InnerElement click called');
                // Publish NDN content under specified name
                
            });
        };
        VideoControlElement.attributeChangedCallback = function(attr, oldVal, newVal) {
            
        };
        window.videoControlElement = thatDoc.registerElement('video-control', {
            prototype: VideoControlElement
        });
    })(window, document);
    
    // Turn a parameter string into an array
    function JSONStringToArray(string) {
        var array = JSON.parse(string);
        return array;
    }
</script>